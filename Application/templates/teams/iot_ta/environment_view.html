{% extends "sidebar.html" %}

{% block content %}
{% load static %}
{% load custom_tags %}

<title>IOT Environments</title>

<link rel="stylesheet" type="text/css" href="{% static 'css/teams/iot_ta/environments/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/teams/iot_ta/iot_home.css' %}">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>


<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol>
  <div class="carousel-inner" style="height:500px !important;">
    <div class="carousel-item active">
      <img class="d-block w-100" src="{% static 'media/iot/environments/iot-1.jpg' %}" alt="First slide" style="height:500px; filter: blur(4px); -webkit-filter: blur(4px);">
    	<div class="container">
          <div class="carousel-caption text-start">
            <h1 style="text-shadow: 2px 2px 2px #000000;">IOT Introduction</h1>
            <p style="text-shadow: 2px 2px 2px #000000;">IoT Test Automation team is part of the global Rellab KCE software release testing team. Current locations FRD and ITEC.</p>
            <p><a class="btn btn-lg btn-primary" href="https://confluence.kone.cbyte.fi/display/RQR/IoT+Test+Automation">Learn More</a></p>
          </div>
        </div>
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="{% static 'media/iot/environments/iot-2.jpg' %}" alt="Second slide" style="height:500px;  filter: blur(4px); -webkit-filter: blur(4px);">
    <div class="container">
          <div class="carousel-caption">
            <h1 style="text-shadow: 3px 3px 3px #000000;">IOT Test Environments</h1>
            <p style="text-shadow: 3px 3px 3px #000000;">All IOT related environments can be found here.</p>
            <p><a class="btn btn-lg btn-primary" href="https://confluence.kone.cbyte.fi/display/RQR/IoT+Test+Environments">Learn more</a></p>
          </div>
        </div>
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="{% static 'media/iot/environments/iot-3.jpg' %}" alt="Third slide" style="height:500px;  filter: blur(4px); -webkit-filter: blur(4px);">
    	<div class="container">
          <div class="carousel-caption text-end">
            <h1 style="text-shadow: 2px 2px 2px #000000;">TA Simulator Setup Guidelines</h1>
            <p style="text-shadow: 2px 2px 2px #000000;">Page contains instructions/guidelines how to setup RELLAB TA simulator. Currently we have two type of simulator HW configuration. The old ones are using shiftregister  type IO control and new ones are using Beckhoff PLC to control IO. Mostly this document applies to both architectures but still Beckhoff simulator is considered as a primary objective.</p>
            <p><a class="btn btn-lg btn-primary" href="https://confluence.kone.cbyte.fi/display/RQR/TA+Simulator+Setup+-+Guidelines">Browse Guidelines</a></p>
          </div>
        </div>
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div><br>

<a class="btn btn-dark" href="{% url 'iot_ta' %}" id="go_back"><i class='bx bx-arrow-back' id='back_icon'></i> Back</a>

<div class="container">
  <p style="text-align:center;">
    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
      What is Reservoir?
    </a></p>

  <!-- Collapse -->
  <div class="collapse" id="collapseExample">
    <div class="card card-body">
      Reservoir is the place where you can see the status of all environments. It helps you to identify which environment is free and which are all reserved. It also tells you last reserved status, timing and reserved user.<hr>
      <a style="margin: auto; width: 18rem;" class="btn btn-primary" href="http://csiservices.rd.konenet.com/reservoir/list?pool=Rellab-IoT" target="_blank">Take Me To Reservoir &raquo;</a>
    </div>
  </div>
</div>


<div class="overlay"></div>
<div id="loading" style="display: none;">
<div class="boxes">
  <div class="box">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
  </div>
  <div class="box">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
  <div class="box">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
  <div class="box">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
</div>
<div class="loading-text" style="display: none; z-index: 999;"><strong>Please wait this will take few minutes...</strong></div>
</div>

<div class="grid-container">
	{% for simu, env in configurations.items %}
	<div class="col" style="height: 350px;">
		{% with 'SIMU232 SIMU362' as list %}
			{% if simu not in list.split %}
			<figure class="figure" style="width: 140px; height: 140px; border-radius: 50%;">
		  <img src="{% static 'media/iot/environments/elevator-placeholder.jpg' %}" class="figure" alt="..." style="width: 140px; height: 140px; border-radius: 50%;">
			</figure>
      {% else %}
      <figure class="figure" style="width: 140px; height: 140px; border-radius: 50%;">
		  <img src="{% static 'media/iot/environments/escalator-placeholder.jpg' %}" class="figure" alt="..." style="width: 140px; height: 140px; border-radius: 50%;">
			</figure>
      {% endif %}
    {% endwith %}
      <h2 class="fw-normal">{{ simu | cut:"_" }}</h2>

       	{% for item, full_desc in desc.items  %}
       		{% if item == simu %}
            <span>{{ full_desc.ip }} | {{ full_desc.model }}<br></span>
        		<span><strong>Location :</strong> {{ full_desc.location }}</span>
            {% else %}
        	{% endif %}
        {% endfor %}
        <br>
        <button class="btn btn-primary" style="width: 150px;" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvas{{ simu }}" aria-controls="offcanvas{{ simu }}">Live details &raquo;</button>
      	
        <div class="offcanvas offcanvas-end" style="width: 700px;" tabindex="-1" id="offcanvas{{ simu }}" aria-labelledby="offcanvasRightLabel">
				  <div class="offcanvas-header">
			    <h5 class="offcanvas-title" id="offcanvasRightLabel">Connected Devices</h5>
			    <i type="button" class="bx bx-x bx-tada bx-rotate-180" data-bs-dismiss="offcanvas" aria-label="Close";></i>
				  </div>
				  <div class="offcanvas-body" style="text-align: center;">
			  {% for environment, identifiers in env.items  %}
			   	<hr><h3><span class="badge badge-secondary">{{ environment }}</span>  Environment</h3><hr>
			    <div class="volume">	
          {% for combo, vals in identifiers.items %}

            {% for live_simulator, live_values in live_data.items %}
              {% if live_simulator == simu %}
                {% for live_env, live_device_data in live_values.items %}
                  {% if live_env == environment %}
                    {% for live_dev_identifier, live_status in live_device_data.items %}
                      {% if live_dev_identifier == combo %}
                      {% if live_status.status.firmware_version == 'NA' %}
                      <div id="card_dev" style="opacity: 0.5;">
                      {% else %}
                      <div id="card_dev">
                      {% endif %}
                        <div class="card border-dark mb-3">
                          <div class="card-header">Device Identifier : {{ combo }}</div>
                          <div class="card-body text-dark">
                          <h5 class="card-title">{{ vals.ken }}</h5>
                            <div class="card-text">
                              
                              <p>DTU Software : {{ live_status.status.firmware_version }}</p>
                              <hr>
                              <table class="table table-borderless" style="text-align: left;">
                                <tbody>
                                  <tr>
                                    {% if 'OK' == live_status.status.controller_connection_status %}
                                    <td scope="col"><div class="led-green"></div></td>
                                    {% else %}
                                    <td scope="col"><div class="led-red"></div></td>
                                    {% endif %}
                                    <td scope="col">Controller Connection</td>
                                  </tr>
                                  <tr>
                                    {% if 'Connected' == live_status.status.iot_connection_status %}
                                    <td scope="col"><div class="led-green"></div></td>
                                    {% else %}
                                    <td scope="col"><div class="led-red"></div></td>
                                    {% endif %}
                                    <td scope="col">IOT Connection</td>
                                  </tr>
                                  <tr>
                                    {% if 'LTE' == live_status.cellular.network_type %}
                                    <td scope="col"><div class="led-green"></div></td>
                                    {% elif 'GSM/GPRS' == live_status.cellular.network_type %}
                                    <td scope="col"><div class="led-yellow"></div></td>
                                    {% else %}
                                    <td scope="col"><div class="led-red"></div></td>
                                    {% endif %}
                                    <td scope="col">Network Status | {{ live_status.cellular.network_type }} </td>
                                  </tr>
                                </tbody>
                              </table>
                              <hr>
                              <p>DTU Board : {{ live_status.status.device_model }}</p>
                              <p>Controller SW Version : {{ live_status.status.software_version }}</p>
                              <p>Route IP : {{ vals.ip }}</p>
                            </div>
                          </div>
                        </div>            
                      </div>

                        
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endfor %}
									
					{% endfor %}
          </div>
				{% endfor %}
			  </div>
			</div>
  </div>
	{% endfor %}
</div>
 <style>
   @media screen and (min-width:400px) {
.offcanvas-title{
height: 100%;
max-width:75%;
margin: 0 auto;
}
}
 </style>

<script>
window.addEventListener("beforeunload", function () {
    document.querySelector('#loading').style.display = "block";
    document.querySelector('.overlay').style.display = "block";
    document.querySelector('.loading-text').style.display = "block";
});
</script>

{% endblock %}
